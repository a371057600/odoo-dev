<!-- 普通用户在使用功能前需获得相应的权限。
     Odoo 中使用安全组来实现，权限授予组，组中分配用户。
     Odoo 应用通常有两个组：
针对普通用户的用户组，包含额外应用配置权限的管理员组。 -->
<?xml version="1.0" ?>
<odoo>
    <!-- 在ir.module.category模型中创建针对图书应用的分类 -->
    <record id="module_library_category" model="ir.module.category">
        <field name="name">Library</field>
    </record>
    <!-- Library User Group -->
    <!-- 记录在res.groups模型中创建，添加了三个字段：
            name：组名
            category_id：关联应用，这是一个关联字段，因此使用了 ref 属性来通过 XML ID 连接已创建的分类
            implied_ids：这是一个one-to-many关联字段，包含一系列组来对组内用户生效。
                         编号4来连接基本内部用户组base.group_user -->
    <record id="library_group_user" model="res.groups">
        <field name="name">User</field>
        <field name="category_id" ref="module_library_category" />
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]" />
    </record>
    <!-- Library Manager Group -->
    <!-- 添加了一个 users 字段，让管理员和内部 root 用户自动成为应用管理员 -->
    <record id="library_group_manager" model="res.groups">
        <field name="name">Manager</field>
        <field name="category_id" ref="module_library_category" />
        <field name="implied_ids" eval="[(4, ref('library_group_user'))]" />
        <field name="users" eval="[
                    (4, ref('base.user_root')),
                    (4, ref('base.user_admin'))
                ]" />
    </record>

    <!-- 记录规则在ir.rule中定义 -->
    <!-- 规则应用于指定安全组，我们这里应用的是雇员组。
         如果没有指定的安全组，则应用于全局(global 字段自动设为 True)。
         全局规则不同，它们做的限制非全局规则无法重载。 -->
    <!-- 记录规则位于<data noupdate=”1″>元素中，表示这些记录在模型安装时会被创建
         但在模型更新时不会被重写
         这么做是允许对规则在后面做自定义但避免在执行模型升级时自定义内容丢失。 -->
    <!-- 开发过程noupdate=”1″会带来麻烦，因为要修复规则时模块更新不会在数据库中重写数据
         所以在开发时可以修改为noupdate=”0″来让数据达到预期结果 -->
    <data noupdate="1">
        <record id="book_user_rule" model="ir.rule">
            <field name="name">Library Book User Access</field>
            <field name="model_id" ref="model_library_book" />
            <field name="domain_force">
                [('active','=',True)]
            </field>
            <field name="groups" eval="[(4,ref('library_group_user'))]" />
        </record>
    </data>
</odoo>
